<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" oncontextmenu="return false" onselectstart="return false" ondragstart="return false" onbeforecopy="return false" oncopy=document.selection.empty() onselect=document.selection.empty()>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="target-densitydpi=640,width=1280,user-scalable=no">
    <title>超屌扑克牌游戏</title>
</head>

<body>

    <div id="framediv" style="position: absolute;left: 50%;margin-left: -640px;background:#ffff00;width:1280px;height:720px;top: 0px">
        <canvas id="cvsblack" width=1280 height=720 style="border:0px solid #c3c3c3;background:black;position:absolute;left: 0;"></canvas>
        <canvas id="cvsbg" width=1280 height=720 style="border:0px solid #c3c3c3;position:absolute;left: 0;"></canvas>
        <canvas id="cvs" width=1280 height=720 style="border:0px solid #c3c3c3;position:absolute;left: 0;"></canvas>
        <canvas id="interface" width=1280 height=720 style="border:0px solid #c3c3c3;position:absolute;left: 0;cursor:crosshair;"></canvas>

        <div id="bstate" style="font-size:10px;line-height:20px;position: absolute;left: 50%;margin-left: -640px;background:#ffff00;height:20px;top: 700px">
        </div>

    </div>

    <div style="position: absolute;background:#ffff00;top: 45%;left: 0%;">
        <div>
            <button id="playstop" onClick="ssstop()">▎▎</button>
            <button id="playgoon" onClick="gggoon()"> ▶ </button>
            <button id="playgoonstop" onClick="gggoonstop()">▎▶</button>
        </div>
        <!--<div id="xywh">blank</div>
        <canvas id="cvstest" width=100 height=100 style="border:0px solid #c3c3c3;background:blue;" onmousemove="cnvs_getCoordinates(event)" onclick="ctestcc()"></canvas>-->
    </div>

    <div id="divframe" style="position: absolute;background:#ffff00;top: 20%;left: 0%;">
        <canvas id="cvsload" width=100 height=100 style="border:0px solid #c3c3c3;background:blue;"></canvas>
        <div id="demo"></div>
        <div id="demo10"></div>
        <div id="demo11"></div>
        <div id="demo12"></div>
        <div id="demo14"></div>
        <div id="demo2"></div>
        <div id="demo3"></div>
        <div id="demo4"></div>
        <div id="demo5"></div>
        <div id="demo6"></div>
        <div id="demo7"></div>
        <div id="demo8"></div>
        <div id="demo9"></div>
        <div id="demo13"></div>
        <div></div>
        <div>
            <input id="isdebug" type="checkbox">Debug line
        </div>
        <div>
            AI强度（1~5）：
            <select id="test_AI">
                <option>lv.1</option>
                <option>lv.2</option>
                <option>lv.3</option>
                <option>lv.4</option>
                <option>lv.5</option>
            </select>
        </div>
    </div>

    <div id="resource" style="position: absolute;visibility:hidden;">
    </div>

    <div id="hidden" style="position: absolute;visibility:hidden;">
        <img id="poker,13,5,1"
             src="system/pic/poker.png">
        <!--<img id="arrow"
             src="system/pic/arrow.png"
             onload="picloader(this,1,2,0,25,25);">
        <img id="character_s"
             src="system/pic/character_s.png"
             onload="picloader(this,2,1,1,100,100);">-->

        <audio id="ok"
               src="system/se/ok.mp3"></audio>
        <audio id="cancel"
               src="system/se/cancel.mp3"></audio>
    </div>
    <!--<audio id="ticktack" src="system/se/ticktack.mp3" oncanplaythrough="audioloader();"></audio>

    <audio id="001" src="system/se/001.mp3" oncanplaythrough="audioloader();"></audio>
    <audio id="006" src="system/se/006.mp3" oncanplaythrough="audioloader();"></audio>
    <audio id="007" src="system/se/007.mp3" oncanplaythrough="audioloader();"></audio>
    <audio id="012" src="system/se/012.mp3" oncanplaythrough="audioloader();"></audio>
    <audio id="016" src="system/se/016.mp3" oncanplaythrough="audioloader();"></audio>
    <audio id="017" src="system/se/017.mp3" oncanplaythrough="audioloader();"></audio>
    <audio id="031" src="system/se/031.mp3" oncanplaythrough="audioloader();"></audio>
    <audio id="095" src="system/se/095.mp3" oncanplaythrough="audioloader();"></audio>-->

    <script src="system/js/system.js" charset="gbk"></script>
    <script src="system/js/interface.js" charset="gbk"></script>
    <script src="system/js/card.js"></script>
    <script src="system/js/arcade.js"></script>
    <!--<script src="system/js/bg.js" charset="gbk"></script>

    <script src="system/js/beta.js" charset="gbk"></script>-->

    <script type="text/javascript">
        var gametitle = document.title;
        var gamesize = { width: 1280, height: 720 }
        var cload = document.getElementById("cvsload");
        var ctxload = cload.getContext("2d");
        var cbg = document.getElementById("cvsbg");
        var ctxbg = cbg.getContext("2d");
        var c = document.getElementById("cvs");
        var ctx = c.getContext("2d");
        var cif = document.getElementById("interface");
        var ctxif = cif.getContext("2d");
        var totaldata = 999;
        var loadeddata = 0;
        var object = new Array();
        var objectif = new Array();
        var objectbg = new Array();
        var previous = [];
        var mainloop = true;
        var intervalID = -1;
        var requestId;
        var clear = 0;
        var GameFPS;
        //var groundvalue = 1180;
        var groundvalue = 720;
        var gamespace = 50;

        var vg = 1;
        var vf = 0.1;

        var p1hpgage = { x: 50, y: 50, w: 500, h: 20 }
        var p2hpgage = { x: 1230, y: 50, w: 500, h: 20 }

        var visualswitch = false;
        var visualobject;
        var visualX = 0;
        var visualY = 0;
        //var focusrate = 1;
        //var rangeXY = 0;
        var pregp = "";
        var nowgp = "";

        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';
        //取消滚动条

        //var ctest = document.getElementById("cvstest");
        //var ctxtest = ctest.getContext("2d");

        var player1 = {
            name: "ryuuou",
            score: 0,
            up: 87,
            down: 83,
            left: 65,
            right: 68,
            a: 74,
            b: 75,
            c: 76
        };

        var player2 = {
            name: "meijin",
            score: 0,
            up: 38,
            down: 40,
            left: 37,
            right: 39,
            a: 97,
            b: 98,
            c: 99
        };
        //按键设置

        var g_player1 = undefined;
        var g_player2 = undefined;

        var mouse = { centerX: 0, centerY: 0 };

        var ctestswitch = 0;
        var c1x = 0;
        var c1y = 0;
        var c2x = 0;
        var c2y = 0;

        var gameplay = 0;
        var caninput = true;

        objectif.push(new mainphase("g_nowloading", "gamephasecontroller"));//载入Nowloading

        var mouseDown = new Array();;
        var keysDown = {};
        //addEventListener("keydown", function (e) {
        //    keysDown[e.keyCode] = 0;
        //}, false);
        //addEventListener("keyup", function (e) {
        //    delete keysDown[e.keyCode];
        //}, false);
        addEventListener("touchmove", function (e) {
            //e.preventDefault();
            var touch = e.touches[0]; //获取第一个触点
            var x = Number(touch.pageX); //页面触点X坐标
            var y = Number(touch.pageY); //页面触点Y坐标
            cnvs_getCoordinates(x, y);
        }, false);
        addEventListener("touchstart", function (e) {
            mouseDown[e.button] = 1;
        }, false);
        addEventListener("touchend", function (e) {
            if (mouseDown[e.button] >= 3) {
                mouseDown[e.button] = 4;
            }
        }, false);
        addEventListener("mousemove", function (e) {
            cnvs_getCoordinates(e.clientX, e.clientY);
        }, false);
        addEventListener("mousedown", function (e) {
            mouseDown[e.button] = 1;
        }, false);
        addEventListener("mouseup", function (e) {
            if (mouseDown[e.button] >= 3) {
                mouseDown[e.button] = 4;
            }
        }, false);
        //未压下=undefined
        //刚压下=2
        //压下中=3
        //单击（刚放开）=5

        //setInterval(update, 1);
        QueueNewFrame();
    </script>

    <script type="text/javascript">

        var h = document.getElementById("hidden");
        var res = document.getElementById("resource");

        totaldata = h.children.length;

        var flag = setInterval(loadresource, 1 / GameFPS * 1000);

        function loadresource() {
            if (loadeddata >= totaldata) {
                clearInterval(flag);
                h.parentNode.removeChild(h);
                return;
            }

            var imgs = h.getElementsByTagName("img");

            for (var num = 0; num < imgs.length; num++) {
                if (imgs[num].complete) {
                    var para = imgs[num].id.split(",", 4)
                    var name = para[0];
                    var r = Number(para[1]);
                    var c = Number(para[2]);
                    var l = Number(para[3]);

                    cload.width = imgs[num].width / r - l;
                    cload.height = imgs[num].height / c - l;
                    var i = 0;
                    for (var y = 0; y < c; y++) {
                        for (var x = 0; x < r; x++) {
                            var image = document.createElement("img");
                            image.id = name + "_" + i;
                            image.style.position = "absolute";
                            ctxload.drawImage(imgs[num], x * (cload.width + l), y * (cload.height + l), cload.width, cload.height, 0, 0, cload.width, cload.height);
                            image.src = cload.toDataURL("image/png");
                            ctxload.clearRect(0, 0, cload.width, cload.height);
                            res.appendChild(image);
                            i += 1;
                        }
                    }
                    h.removeChild(imgs[num]);
                    loadeddata += 1;
                }
            }

            var audios = h.getElementsByTagName("audio");

            for (var num = 0; num < audios.length; num++) {
                if (audios[num].readyState == 4) {
                    res.appendChild(audios[num]);
                    loadeddata += 1;
                }
            }
        }
    </script>
</body>

</html>
